# راهنمای کاربری سیستم CI/CD مونوریپو Aladdin-sandbox

## مقدمه
این سند راهنمای کاربری برای سیستم یکپارچه‌سازی مداوم/استقرار مداوم (CI/CD) پیاده‌سازی شده در مونوریپو `aladdin-sandbox` است. هدف این راهنما، آشنایی کاربران با نحوه تعامل با سیستم CI/CD، درک وضعیت پروژه‌ها و استفاده از قابلیت‌های آن برای تسریع فرآیند توسعه و استقرار است.

## 1. مفاهیم اساسی CI/CD

*   **یکپارچه‌سازی مداوم (Continuous Integration - CI)**: فرآیندی که در آن توسعه‌دهندگان به طور مکرر تغییرات کد خود را در یک مخزن مشترک ادغام می‌کنند. هر ادغام با یک بیلد خودکار و اجرای تست‌ها تأیید می‌شود تا مشکلات یکپارچه‌سازی به سرعت شناسایی شوند.
*   **استقرار مداوم (Continuous Deployment - CD)**: فرآیندی که در آن کد پس از موفقیت‌آمیز بودن تمامی مراحل CI و تست، به طور خودکار به محیط‌های مختلف (مانند استیجینگ و پروداکشن) مستقر می‌شود.
*   **مونوریپو (Monorepo)**: یک مخزن کد واحد که شامل چندین پروژه مستقل است. سیستم CI/CD ما برای مدیریت این پروژه‌ها به صورت جداگانه و در عین حال یکپارچه طراحی شده است.

## 2. ساختار پروژه و فایل‌های کلیدی

*   **`apps/`**: این پوشه شامل تمامی پروژه‌های مستقل (مانند `backend`, `frontend`, `youtube_automation`) است.
*   **`config/projects.yaml`**: فایل پیکربندی مرکزی که تمامی پروژه‌ها، دستورات بیلد و تست آن‌ها، و تنظیمات استقرار برای محیط‌های مختلف را تعریف می‌کند.
*   **`infra/ci-cd/mamos_runner.py`**: اسکریپت اصلی CI/CD که مسئول اجرای مراحل بیلد، تست و استقرار برای هر پروژه است.
*   **`.github/workflows/`**: این پوشه شامل فایل‌های GitHub Actions Workflow (با پسوند `.yml`) است که منطق اجرای CI/CD را برای هر پروژه تعریف می‌کنند.
*   **`reports/`**: این پوشه شامل گزارش‌های تولید شده توسط `mamos_runner.py` پس از هر اجرای CI/CD است (`summary.md` و `details/*.md`).

## 3. نحوه تعامل با سیستم CI/CD

سیستم CI/CD به طور خودکار با هر `push` به شاخه `main` (یا شاخه‌های پیکربندی شده دیگر) فعال می‌شود. با این حال، کاربران می‌توانند به صورت دستی نیز با آن تعامل داشته باشند:

### 3.1. مشاهده وضعیت CI/CD

1.  **داشبورد GitHub Actions**: به مخزن GitHub خود بروید و روی تب `Actions` کلیک کنید. در اینجا می‌توانید لیست تمامی Workflowهای اجرا شده، وضعیت آن‌ها (موفق، ناموفق، در حال اجرا) و جزئیات هر اجرا را مشاهده کنید.
2.  **گزارش‌های محلی**: پس از اجرای `mamos_runner.py` (چه به صورت دستی و چه از طریق GitHub Actions)، گزارش‌های مفصلی در پوشه `aladdin-sandbox/reports/` تولید می‌شوند:
    *   `summary.md`: یک خلاصه کلی از وضعیت بیلد و تست تمامی پروژه‌ها.
    *   `details/<project_name>_report.md`: گزارش‌های جزئی برای هر پروژه، شامل خروجی کامل مراحل بیلد، تست و استقرار.

### 3.2. اجرای دستی Workflowها (Manual Trigger)

برای اجرای دستی یک Workflow خاص (مثلاً برای تست یک ویژگی یا استقرار در یک محیط خاص)، می‌توانید از قابلیت `workflow_dispatch` در GitHub Actions استفاده کنید:

1.  به تب `Actions` در مخزن GitHub خود بروید.
2.  Workflow مورد نظر خود را از لیست سمت چپ انتخاب کنید (مثلاً `backend.yml` یا `youtube_automation.yml`).
3.  روی دکمه `Run workflow` (معمولاً در سمت راست بالای صفحه) کلیک کنید.
4.  در پنجره باز شده، می‌توانید شاخه (Branch) مورد نظر و در صورت وجود، پارامترهای ورودی (مانند نام پروژه یا محیط استقرار) را انتخاب کنید.
5.  روی `Run workflow` کلیک کنید تا اجرا آغاز شود.

### 3.3. تایید دستی استقرار (Manual Approval for Deployment)

برای محیط‌های حساس مانند `Staging` و `Production`، سیستم CI/CD نیاز به تایید دستی دارد:

1.  پس از اجرای موفقیت‌آمیز مراحل بیلد و تست، Workflow به مرحله تایید دستی می‌رسد.
2.  در داشبورد GitHub Actions، اجرای Workflow مربوطه را مشاهده خواهید کرد که در وضعیت `Waiting` (در انتظار) قرار دارد.
3.  روی اجرای Workflow کلیک کنید تا جزئیات آن را ببینید.
4.  در بخش `Jobs`، Job مربوط به استقرار (مثلاً `deploy-staging` یا `deploy-production`) را پیدا کنید.
5.  یک دکمه `Review deployments` یا مشابه آن را مشاهده خواهید کرد. روی آن کلیک کنید.
6.  پس از بازبینی، می‌توانید استقرار را `Approve` (تایید) یا `Reject` (رد) کنید. با تایید، Workflow ادامه یافته و استقرار انجام می‌شود.

## 4. عیب‌یابی رایج

*   **بیلد یا تست ناموفق**: ابتدا گزارش جزئی پروژه (`details/<project_name>_report.md`) را بررسی کنید. این گزارش شامل خروجی کامل دستورات و پیام‌های خطا است که به شناسایی ریشه مشکل کمک می‌کند.
*   **Workflow اجرا نمی‌شود**: اطمینان حاصل کنید که تغییرات شما در شاخه صحیح `push` شده‌اند و مسیرهای تعریف شده در Workflow (`on: push: paths:`) با تغییرات شما مطابقت دارند.
*   **خطای `401 Client Error: Unauthorized` در استقرار**: این خطا معمولاً به دلیل عدم وجود یا نامعتبر بودن `RENDER_API_KEY` در GitHub Secrets رخ می‌دهد. با مدیر سیستم تماس بگیرید تا از پیکربندی صحیح Secrets اطمینان حاصل کنید.

## 5. پشتیبانی

در صورت بروز هرگونه مشکل یا سوالی که در این راهنما پوشش داده نشده است، لطفاً با تیم پشتیبانی یا مدیر سیستم تماس بگیرید.
