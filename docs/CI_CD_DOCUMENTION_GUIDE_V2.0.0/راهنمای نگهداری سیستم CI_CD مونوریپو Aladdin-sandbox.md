# راهنمای نگهداری سیستم CI/CD مونوریپو Aladdin-sandbox

## مقدمه
این سند راهنمای نگهداری برای سیستم یکپارچه‌سازی مداوم/استقرار مداوم (CI/CD) پیاده‌سازی شده در مونوریپو `aladdin-sandbox` است. هدف این راهنما، ارائه دستورالعمل‌هایی برای اطمینان از عملکرد صحیح، پایداری و امنیت سیستم CI/CD در طول زمان است.

## 1. بررسی‌های دوره‌ای و نظارت

برای اطمینان از سلامت سیستم CI/CD، بررسی‌های دوره‌ای و نظارت فعال ضروری است:

*   **نظارت بر اجرای Workflowها**: به طور منظم داشبورد GitHub Actions را بررسی کنید تا از وضعیت اجرای Workflowها مطلع شوید. به دنبال Workflowهای ناموفق، Workflowهایی که زمان زیادی برای اجرا می‌برند، یا Workflowهایی که به طور غیرمنتظره فعال شده‌اند، باشید.
*   **بررسی گزارش‌های `mamos_runner.py`**: گزارش‌های تولید شده در `aladdin-sandbox/reports/` را بررسی کنید. فایل `summary.md` یک نمای کلی ارائه می‌دهد و فایل‌های `details/*.md` جزئیات بیشتری را در صورت بروز مشکل نشان می‌دهند.
*   **بررسی مصرف منابع**: در GitHub Actions، می‌توانید مصرف منابع (مانند زمان اجرا) را برای Workflowها مشاهده کنید. افزایش ناگهانی در مصرف منابع ممکن است نشان‌دهنده مشکلاتی مانند حلقه‌های بی‌نهایت، تست‌های ناکارآمد یا تغییرات ناخواسته باشد.
*   **بررسی وضعیت سرویس‌های خارجی**: وضعیت سرویس‌های خارجی مانند GitHub (برای GitHub Actions) و Render.com (برای استقرار) را به طور منظم بررسی کنید تا از در دسترس بودن آن‌ها اطمینان حاصل کنید.

## 2. مدیریت پیکربندی

پیکربندی سیستم CI/CD باید به دقت مدیریت شود:

*   **`config/projects.yaml`**: این فایل حاوی پیکربندی تمامی پروژه‌ها است. هرگونه تغییر در دستورات بیلد، تست یا تنظیمات استقرار باید با دقت انجام شود و قبل از ادغام در شاخه `main`، تست شود.
    *   **افزودن پروژه جدید**: برای افزودن یک پروژه جدید، یک ورودی جدید در `projects.yaml` ایجاد کنید و دستورات `build`، `test` و `deploy` آن را تعریف کنید.
    *   **به‌روزرسانی پروژه موجود**: در صورت تغییر در فرآیند بیلد یا تست یک پروژه، ورودی مربوطه در `projects.yaml` را به‌روزرسانی کنید.
*   **GitHub Actions Workflows (`.github/workflows/*.yml`)**: این فایل‌ها منطق اجرای CI/CD را تعریف می‌کنند. هرگونه تغییر در این فایل‌ها (مانند تغییر تریگرها، مجوزها یا مراحل) باید با دقت بازبینی و تست شود.
*   **مدیریت Secrets**: `RENDER_API_KEY` و سایر Secrets در GitHub Secrets ذخیره می‌شوند. اطمینان حاصل کنید که این Secrets به‌روز هستند و فقط توسط افراد مجاز قابل دسترسی هستند. سیاست‌های چرخش (rotation) Secrets را رعایت کنید.

## 3. عیب‌یابی و رفع مشکلات

*   **Workflow ناموفق**: 
    1.  به داشبورد GitHub Actions بروید و روی اجرای Workflow ناموفق کلیک کنید.
    2.  Job ناموفق را پیدا کنید و لاگ‌های آن را بررسی کنید. پیام‌های خطا معمولاً در انتهای لاگ‌ها قرار دارند.
    3.  اگر مشکل مربوط به `mamos_runner.py` است، گزارش جزئی پروژه (`aladdin-sandbox/reports/details/<project_name>_report.md`) را بررسی کنید.
    4.  بر اساس پیام خطا، کد مربوطه (در پروژه، `mamos_runner.py` یا فایل‌های Workflow) را بررسی و اصلاح کنید.
*   **مشکلات استقرار**: 
    1.  اگر استقرار ناموفق بود، لاگ‌های Job استقرار در GitHub Actions را بررسی کنید.
    2.  اگر خطای `401 Client Error: Unauthorized` مشاهده شد، `RENDER_API_KEY` را در GitHub Secrets بررسی کنید.
    3.  اگر خطای دیگری از Render.com دریافت شد، داشبورد Render.com را برای جزئیات بیشتر بررسی کنید.
*   **مشکلات عملکردی**: 
    1.  اگر Workflowها به طور غیرمنتظره‌ای کند شده‌اند، مصرف منابع (CPU/RAM) را در GitHub Actions بررسی کنید.
    2.  تست‌های ناکارآمد یا حلقه‌های بی‌نهایت در کد پروژه می‌توانند باعث افزایش زمان اجرا شوند. ابزارهای پروفایلینگ (profiling) را در صورت لزوم به مرحله تست اضافه کنید.

## 4. به‌روزرسانی و ارتقاء

*   **به‌روزرسانی وابستگی‌ها**: به طور منظم وابستگی‌های پروژه‌ها (در `requirements.txt` برای پایتون، `package.json` برای Node.js) را به‌روزرسانی کنید. این کار به بهبود امنیت و عملکرد کمک می‌کند.
*   **به‌روزرسانی GitHub Actions**: GitHub به طور مداوم قابلیت‌های جدیدی را به GitHub Actions اضافه می‌کند. Workflowهای خود را برای استفاده از آخرین نسخه‌ها و بهترین شیوه‌ها به‌روزرسانی کنید.
*   **به‌روزرسانی `mamos_runner.py`**: در صورت نیاز به افزودن قابلیت‌های جدید یا بهبود عملکرد `mamos_runner.py`، آن را به‌روزرسانی کنید. این تغییرات باید با دقت تست شوند.

## 5. امنیت

*   **بازبینی Secrets**: به طور منظم Secrets ذخیره شده در GitHub را بازبینی و در صورت لزوم چرخش (rotate) دهید.
*   **کنترل دسترسی**: اطمینان حاصل کنید که فقط افراد مجاز به مخزن GitHub و GitHub Secrets دسترسی دارند.
*   **اسکن امنیتی**: ابزارهای اسکن امنیتی (مانند اسکنرهای آسیب‌پذیری کد یا وابستگی‌ها) را به خط لوله CI/CD اضافه کنید تا به طور خودکار آسیب‌پذیری‌ها را شناسایی کنند.

## 6. مستندسازی

*   هرگونه تغییر مهم در سیستم CI/CD، پیکربندی‌ها یا فرآیندهای نگهداری باید در مستندات مربوطه (مانند همین راهنما) ثبت شود. این امر به حفظ دانش و تسهیل فرآیند آموزش برای اعضای جدید تیم کمک می‌کند.

## 7. پشتیبانی

در صورت بروز مشکلات پیچیده یا نیاز به کمک تخصصی، با تیم پشتیبانی یا متخصصان CI/CD مشورت کنید.
